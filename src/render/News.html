<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تطبيق الأخبار</title>
  <!-- تضمين مكتبة Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div>
      <!-- Navbar -->
      
      <div id="navbar-container"></div>
      
      <script>
        // تحميل محتوى nav.html داخل العنصر الفارغ
        fetch('../componet/nav.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('navbar-container').innerHTML = data;
          })
          .catch(error => console.error('Error loading navbar:', error));
      </script>
    </div>
  <div class="flex justify-center items-center h-screen mt-32">
    <div class="rounded-lg shadow-lg p-6 border border-gray-300 w-3/4 bg-white">
      <h1 class="text-center text-3xl font-bold mb-6 text-gray-800 ">آخر الأخبار</h1>
      <div id="news-container">
        <!-- سيتم تعبئة الأخبار هنا باستخدام JavaScript -->
      </div>
    </div>
  </div>

  <!-- النافذة المنبثقة للتعديل -->
  <div id="edit-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
    <div class="flex items-center justify-center min-h-screen">
      <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-300 w-1/2">
        <h2 class="text-2xl font-bold mb-4">تعديل الخبر</h2>
        <div id="modal-content">
          <!-- سيتم تعبئة بيانات الخبر هنا -->
        </div>
        <div class="flex justify-end mt-4">
          <button onclick="closeModal()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mr-2">إلغاء</button>
          <button onclick="handleSave()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">حفظ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- تضمين ملف JavaScript لاسترجاع البيانات من الAPI -->
  <script>
    async function fetchData() {
      try {
        const response = await fetch('https://node-js-simpleblog811.onrender.com/api');
        if (!response.ok) {
          throw new Error('Failed to fetch data');
        }
        const data = await response.json();
        displayNews(data);
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    function displayNews(newsData) {
      const newsContainer = document.getElementById('news-container');
      newsData.forEach(item => {
        const newsItem = document.createElement('div');
        newsItem.classList.add('p-6', 'border-b', 'border-gray-200');
        newsItem.id = `news-item-${item.id}`; // تعيين الهوية للعنصر
        newsItem.innerHTML = `
          <h2 class="text-xl font-semibold mb-2 text-gray-800">${item.title}</h2>
          <p class="text-gray-700">${item.tobic}</p>
          <p class="text-gray-700 mt-2"> ${item.place} <span class="font-semibold text-gray-800">:موقع الخبر</span></p>
          <p class="text-gray-700"> ${item.createdAt.substring(0, 10)} <span class="font-semibold text-gray-800">:تاريخ الخبر</span></p>
          <div class="flex justify-center mt-4">
            <button onclick="showEditModal('${item.id}', '${item.title}', '${item.tobic}', '${item.place}')" class="mr-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">تعديل</button>
            <button onclick="handleDelete('${item.id}')" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">حذف</button>
          </div>
        `;
        newsContainer.appendChild(newsItem);
      });
    }

    function showEditModal(id, title, tobic, place) {
      const modal = document.getElementById('edit-modal');
      const modalContent = document.getElementById('modal-content');

      // تعبئة البيانات في النافذة المنبثقة
      modalContent.innerHTML = `
        <input type="hidden" id="news-id" value="${id}">
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2" for="news-title">عنوان الخبر</label>
          <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="news-title" type="text" value="${title}">
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2" for="news-tobic">موضوع الخبر</label>
          <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="news-tobic">${tobic}</textarea>
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-bold mb-2" for="news-place">موقع الخبر</label>
          <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="news-place" type="text" value="${place}">
        </div>
      `;

      // عرض النافذة المنبثقة
      modal.classList.remove('hidden');
    }

    function closeModal() {
      const modal = document.getElementById('edit-modal');
      modal.classList.add('hidden');
    }
   

     async function handleSave() {
  const id = document.getElementById('news-id').value;
  const title = document.getElementById('news-title').value;
  const tobic = document.getElementById('news-tobic').value;
  const place = document.getElementById('news-place').value;

  try {
    const response = await fetch(`https://node-js-simpleblog811.onrender.com/api/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ title, tobic, place })
    });

    if (!response.ok) {
      throw new Error('Failed to update data');
    }

    // تحديث العنصر في واجهة المستخدم بدون إعادة تحميل الصفحة
    const newsItem = document.getElementById(`news-item-${id}`);
    newsItem.querySelector('h2').innerText = title;
    newsItem.querySelector('p:nth-of-type(1)').innerText = tobic;
    newsItem.querySelector('p:nth-of-type(2)').innerHTML = `${place} <span class="font-semibold text-gray-800">:موقع الخبر</span>`;

    // إغلاق النافذة المنبثقة
    closeModal();
  } catch (error) {
    console.error('Error updating data:', error);
  }
}

 function closeModal() {
  const modal = document.getElementById('edit-modal');
  modal.classList.add('hidden');
}

  

    async function handleDelete(id) {
      try {
        const newsItem = document.getElementById(`news-item-${id}`);
        if (!newsItem) {
          throw new Error('Item not found');
        }
        newsItem.remove(); // حذف العنصر المحدد مباشرة من الصفحة بناءً على الـ id

        const response = await fetch(`https://node-js-simpleblog811.onrender.com/api/${id}`, {
          method: 'DELETE'
        });
        if (!response.ok) {
          throw new Error('Failed to delete data');
        } else {
          console.log('Data deleted successfully');
        }
      } catch (error) {
        console.error('Error deleting data:', error);
      }
    }

    // عرض الأخبار عند تحميل الصفحة
    fetchData();
  </script>
  

</body>
</html>
